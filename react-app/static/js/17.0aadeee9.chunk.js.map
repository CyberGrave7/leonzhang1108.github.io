{"version":3,"sources":["pages/12bius/index.tsx"],"names":["times","n","func","Array","fill","map","_","i","initFirework","width","height","age","phase","x","Math","floor","random","y","generateFireworks","maxFireworks","maxSparks","__assign","sparks","vx","vy","blue","green","red","weight","generateSparks","ctx","colors","beginPath","fillStyle","r","g","b","a","join","apply","rect","Fireworks12bius","_a","background","_b","_c","_d","_e","canvas","__WEBPACK_IMPORTED_MODULE_1_react__","_f","fireworks","updator","context","current","getContext","clearRect","firework","index","forEach","spark","trailAge","fade","pow","key","draw","others","update","ref","style","defaultProps","__webpack_exports__","__WEBPACK_IMPORTED_MODULE_0__utils__","connect","component","mapStateToProps","state","common","contentWidth","contentHeight"],"mappings":"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","file":"static/js/17.0aadeee9.chunk.js","sourcesContent":["import Utils from '@utils'\nimport * as React from 'react'\ninterface IProps {\n  background?: string\n  width?: number\n  height?: number\n  maxFireworks?: number\n  maxSparks?: number\n}\n\ninterface ISpark {\n  vx: number\n  vy: number\n  weight: number\n  red: number\n  green: number\n  blue: number\n}\n\ninterface IFirework {\n  x: number\n  y: number\n  age: number\n  phase: 'fly' | 'explode'\n  sparks: ISpark[]\n}\n\nconst radius = 4\n\nconst times = (n: number, func: (v: number) => any) =>\n  Array(n)\n    .fill(null)\n    .map((_, i) => func(i))\n\nconst initFirework = (width: number, height: number) => {\n  return {\n    age: 0,\n    phase: 'fly',\n    x: Math.floor(Math.random() * width),\n    y: height\n  }\n}\n\nconst generateSparks = (maxSparks: number) => {\n  return times(maxSparks, (i: number) => {\n    const vx = Math.random() * 5 + 0.5\n    const vy = Math.random() * 5 + 0.5\n\n    return {\n      blue: Math.floor(Math.random() * 2),\n      green: Math.floor(Math.random() * 2),\n      red: Math.floor(Math.random() * 2),\n      vx: Math.random() > 0.5 ? -vx : vx,\n      vy: Math.random() > 0.5 ? -vy : vy,\n      weight: Math.random() * 0.3 + 0.03\n    }\n  })\n}\n\nconst generateFireworks = (\n  width: number,\n  height: number,\n  maxFireworks: number,\n  maxSparks: number\n) => times(maxFireworks, () => ({\n  ...initFirework(width, height),\n  sparks: generateSparks(maxSparks)\n}))\n\nconst toRGBA = (r = 0, g = 0, b = 0, a = 1) => `rgba(${[r, g, b, a].join(',')})`\n\nconst fill = (ctx: any, x: number, y: number, colors: number[]) => {\n  ctx.beginPath()\n  ctx.fillStyle = toRGBA(...colors)\n  ctx.rect(x, y, radius, radius)\n  ctx.fill()\n}\n\nconst draw = (ctx: any, { phase, sparks, age, x, y }: IFirework, index: number) => {\n  if (phase === 'fly') {\n    times(15, (i: number) => {\n      fill(ctx, x + Math.random() * i - i / 2, y + i * radius, [index * 50, i * 17])\n    })\n    return\n  }\n\n  sparks.forEach(spark => {\n    times(10, (i: number) => {\n      const trailAge = age + i\n      const fade = i * 20 - age * 2\n      fill(\n        ctx,\n        x + spark.vx * trailAge,\n        y + spark.vy * trailAge + (spark.weight * trailAge) ** 2,\n        ['red', 'green', 'blue'].map(key => Math.floor(spark[key] * fade))\n      )\n    })\n  })\n}\n\nconst update = (width: number, height: number, firework: IFirework) => {\n  if (firework.phase === 'explode') {\n    const others = firework.age > 100 && Math.random() < 0.05 ? initFirework(width, height) : {}\n    return { ...firework, age: firework.age + 1, ...others }\n  } else {\n    const phase = Math.random() < 0.001 || firework.y < 200 ? 'explode' : firework.phase\n    return { ...firework, y: firework.y - 10, phase }\n  }\n}\n\nconst Fireworks12bius = ({ background, width = 0, height = 0, maxFireworks = 0, maxSparks = 0 }: IProps) => {\n  const canvas: any = React.useRef(null)\n  const [fireworks, updator] = React.useState(\n    generateFireworks(width, height, maxFireworks, maxSparks)\n  )\n\n  React.useEffect(() => {\n    const context = canvas.current.getContext('2d')\n    context.clearRect(0, 0, width, height)\n    updator(\n      fireworks.map((firework: IFirework, index: number) => {\n        draw(context, firework, index)\n        return update(width, height, firework)\n      })\n    )\n  })\n\n  return <canvas ref={canvas} width={width} height={height} style={{ background }} />\n}\n\nFireworks12bius.defaultProps = {\n  background: 'black',\n  maxFireworks: 5,\n  maxSparks: 50\n}\n\nexport default Utils.connect({\n  component: Fireworks12bius,\n  mapStateToProps: state => ({\n    width: state.common.contentWidth,\n    height: state.common.contentHeight\n  })\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/12bius/index.tsx"],"sourceRoot":""}