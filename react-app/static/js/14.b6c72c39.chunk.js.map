{"version":3,"sources":["webpack:///./src/pages/InfiniteList/index.less?aefc","pages/InfiniteList/index.tsx","pages/InfiniteList/index.less"],"names":["content","__webpack_require__","module","i","options","hmr","transform","locals","exports","InfiniteList","_super","_this","apply","this","arguments","randomBoolean","Math","random","initState","setState","list","top","contentHeight","visibleHeight","visibleData","offset","interval","calculateOffset","index","state","length","offsetTop","height","__assign","doCalculate","startIndex","_a","innerOffset","endIndex","findEndIndex","slice","findTopByIndex","findStartIndex","wrapper","clientHeight","calculateEndIndex","scrollHandler","e","target","scrollTop","__extends","prototype","componentWillMount","val","obj","push","reduce","p","c","componentDidMount","render","__WEBPACK_IMPORTED_MODULE_0_react__","className","onScroll","ref","style","map","item","lineHeight","key","__webpack_exports__","version","sources","names","mappings","file","sourcesContent","sourceRoot"],"mappings":"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","file":"static/js/14.b6c72c39.chunk.js","sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/index.js??ref--1-oneOf-0-2!../../../node_modules/postcss-loader/lib/index.js??postcss!../../../node_modules/less-loader/dist/cjs.js??ref--1-oneOf-0-4!./index.less\");\nif(typeof content === 'string') content = [[module.id, content, '']];\n// Prepare cssTransformation\nvar transform;\n\nvar options = {\"hmr\":false}\noptions.transform = transform\n// add the styles to the DOM\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\nif(content.locals) module.exports = content.locals;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/InfiniteList/index.less\n// module id = 394\n// module chunks = 14 42","\nimport * as React from 'react'\nimport './index.less'\n\ninterface IState {\n  list: any[],\n  // 可视区域top\n  top: number,\n  // 数据总高度\n  contentHeight: number,\n  // 可见高度\n  visibleHeight: number,\n  // 可见列表\n  visibleData: any[],\n  // 上下预加载个数\n  offset: number,\n  // 间隔\n  interval: number\n}\n\nclass InfiniteList extends React.Component<{}, IState> {\n\n  wrapper\n\n  randomBoolean = () => Math.random() - 0.5 > 0\n\n  componentWillMount () {\n    this.initState()\n    // init data\n    const list: any[] = []\n\n    for (let val = 0; val < 777; val++) {\n      // randam height\n      const height = this.randomBoolean() ? 60 : 30\n\n      const obj: any = { val, height }\n\n      if (!val) {\n        obj.offsetTop = height\n      }\n\n      list.push(obj)\n    }\n\n    const contentHeight = list.reduce((p, c) => p + c.height, 0)\n\n    this.setState({ list, contentHeight })\n  }\n\n  initState = () => {\n    this.setState({\n      // 总列表，及offsetTop\n      list: [],\n      // 可视区域top\n      top: 0,\n      // 数据总高度\n      contentHeight: 0,\n      // 可见高度\n      visibleHeight: 0,\n      // 可见列表\n      visibleData: [],\n      // 上下预加载个数\n      offset: 10,\n      // 间隔\n      interval: 2\n    })\n  }\n\n  componentDidMount () {\n    // init height & visible data\n    const visibleHeight = this.wrapper.clientHeight\n\n    this.setState({\n      visibleHeight,\n      ...this.doCalculate(0)\n    })\n  }\n\n  calculateOffset = index => {\n    const { list } = this.state\n\n    if (index === list.length) { return }\n\n    // 取缓存\n    if (list[index].offsetTop) { return list[index].offsetTop }\n\n    let offsetTop = list[index].height\n\n    offsetTop += this.calculateOffset(index - 1)\n\n    // 添加缓存\n    list[index] = {\n      ...list[index],\n      offsetTop\n    }\n\n    this.setState({ list })\n\n    return offsetTop\n  }\n\n  doCalculate = startIndex => {\n    const { list, offset } = this.state\n\n    const innerOffset = startIndex = startIndex - offset\n\n    startIndex = startIndex > 0 ? startIndex : 0\n\n    let endIndex = this.findEndIndex(startIndex) + offset * 2 + 1\n\n    endIndex = innerOffset < 0 ? endIndex + innerOffset : endIndex\n\n    endIndex = endIndex > list.length ? list.length : endIndex\n\n    const visibleData = list.slice(startIndex, endIndex)\n\n    const top = this.findTopByIndex(startIndex)\n\n    return { visibleData, top }\n  }\n\n  findTopByIndex = index => index ? this.state.list[index - 1].offsetTop : 0\n\n  findStartIndex = top => {\n    const { list } = this.state\n\n    let index = 0\n\n    while (index < list.length) {\n      if (!list[index].offsetTop) { this.calculateOffset(index) }\n\n      if (top < list[index].offsetTop) { break }\n\n      index++\n    }\n\n    return index\n  }\n\n  findEndIndex = startIndex => {\n    let { visibleHeight } = this.state\n    const { list } = this.state\n\n    // 取缓存\n    if (list[startIndex].endIndex) { return list[startIndex].endIndex }\n\n    visibleHeight = visibleHeight || this.wrapper.clientHeight\n\n    // 计算endIndex\n    const endIndex = this.calculateEndIndex(visibleHeight, startIndex)\n\n    // 加入缓存\n    list[startIndex].endIndex = endIndex\n\n    this.setState({ list })\n\n    return endIndex\n  }\n\n  calculateEndIndex = (visibleHeight, index = 0) => {\n    const { list } = this.state\n\n    while (visibleHeight > 0) {\n      const i = index + 1\n      if (i !== list.length) {\n        visibleHeight -= list[++index].height\n      } else {\n        break\n      }\n    }\n\n    return index\n  }\n\n  scrollHandler = e => {\n    const { interval } = this.state\n\n    const startIndex = this.findStartIndex(e.target.scrollTop)\n\n    if (startIndex % interval === 0) { this.setState(this.doCalculate(startIndex)) }\n  }\n\n  render () {\n    const { visibleData, contentHeight, top } = this.state\n\n    return (\n      <div className='infinite-list-wrapper' onScroll={this.scrollHandler} ref={ref => { this.wrapper = ref }}>\n        <div className='infinite-list-ghost' style={{ height: contentHeight }} />\n        <div className='infinite-list' style={{ transform: `translate3d(0, ${top}px, 0)` }}>\n          { visibleData.map((item, i) => {\n            const style = { height: `${ item.height }px`, lineHeight: `${ item.height }px` }\n            return <div className='item' key={i} style={style}>{`item-${item.val}`}</div>\n          }) }\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default InfiniteList\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/InfiniteList/index.tsx","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(true);\n// imports\n\n\n// module\nexports.push([module.id, \".infinite-list-wrapper{height:100%;width:100%;overflow-y:auto;position:relative}.infinite-list-wrapper .infinite-list-ghost{position:absolute;right:0;width:1px;z-index:-1}.infinite-list-wrapper .infinite-list{overflow:auto;width:100%}.infinite-list-wrapper .infinite-list .item{text-align:center;line-height:30px}.infinite-list-wrapper .infinite-list .item:nth-child(odd){background-color:#eee}\", \"\", {\"version\":3,\"sources\":[\"/Users/leonzhang/Documents/github/typescript/leon-ts-app/src/pages/InfiniteList/index.less\"],\"names\":[],\"mappings\":\"AAAA,uBACE,YAAa,AACb,WAAY,AACZ,gBAAiB,AACjB,iBAAmB,CACpB,AACD,4CACE,kBAAmB,AACnB,QAAS,AACT,UAAW,AACX,UAAY,CACb,AACD,sCACE,cAAe,AACf,UAAY,CACb,AACD,4CACE,kBAAmB,AACnB,gBAAkB,CACnB,AACD,2DACE,qBAAuB,CACxB\",\"file\":\"index.less\",\"sourcesContent\":[\".infinite-list-wrapper {\\n  height: 100%;\\n  width: 100%;\\n  overflow-y: auto;\\n  position: relative;\\n}\\n.infinite-list-wrapper .infinite-list-ghost {\\n  position: absolute;\\n  right: 0;\\n  width: 1px;\\n  z-index: -1;\\n}\\n.infinite-list-wrapper .infinite-list {\\n  overflow: auto;\\n  width: 100%;\\n}\\n.infinite-list-wrapper .infinite-list .item {\\n  text-align: center;\\n  line-height: 30px;\\n}\\n.infinite-list-wrapper .infinite-list .item:nth-child(odd) {\\n  background-color: #eee;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader?{\"importLoaders\":1,\"minimize\":true,\"sourceMap\":true}!./node_modules/postcss-loader/lib?{\"ident\":\"postcss\",\"plugins\":[null,null]}!./node_modules/less-loader/dist/cjs.js?{\"javascriptEnabled\":true}!./src/pages/InfiniteList/index.less\n// module id = 637\n// module chunks = 14 42"],"sourceRoot":""}