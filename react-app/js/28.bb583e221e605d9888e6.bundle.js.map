{"version":3,"sources":["webpack:///./src/pages/12bius/index.tsx"],"names":["times","n","func","Array","fill","map","_","i","initFirework","width","height","age","phase","x","Math","floor","random","y","generateSparks","maxSparks","vx","vy","blue","green","red","weight","toRGBA","r","g","b","a","join","ctx","colors","beginPath","fillStyle","rect","Fireworks12bius","background","maxFireworks","canvas","useRef","sparks","fireworks","updator","useEffect","context","current","getContext","clearRect","firework","index","forEach","spark","trailAge","fade","key","draw","others","update","ref","style","defaultProps","connect","component","mapStateToProps","state","common","contentWidth","contentHeight"],"mappings":"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","file":"js/28.bb583e221e605d9888e6.bundle.js","sourcesContent":["import Utils from '@utils'\nimport React from 'react'\ninterface IProps {\n  background?: string;\n  width?: number;\n  height?: number;\n  maxFireworks?: number;\n  maxSparks?: number;\n}\n\ninterface ISpark {\n  vx: number;\n  vy: number;\n  weight: number;\n  red: number;\n  green: number;\n  blue: number;\n}\n\ninterface IFirework {\n  x: number;\n  y: number;\n  age: number;\n  phase: 'fly' | 'explode';\n  sparks: ISpark[];\n}\n\nconst radius = 5\n\nconst times = (n: number, func: (v: number) => any) =>\n  Array(n)\n    .fill(null)\n    .map((_, i) => func(i))\n\nconst initFirework = (width: number, height: number) => {\n  return {\n    age: 0,\n    phase: 'fly',\n    x: Math.floor(Math.random() * width),\n    y: height\n  }\n}\n\nconst generateSparks = (maxSparks: number) => {\n  return times(maxSparks, (i: number) => {\n    const vx = Math.random() * 5 + 0.5\n    const vy = Math.random() * 5 + 0.5\n\n    return {\n      blue: Math.floor(Math.random() * 2),\n      green: Math.floor(Math.random() * 2),\n      red: Math.floor(Math.random() * 2),\n      vx: Math.random() > 0.5 ? -vx : vx,\n      vy: Math.random() > 0.5 ? -vy : vy,\n      weight: Math.random() * 0.3 + 0.03\n    }\n  })\n}\n\nconst generateFireworks = (\n  width: number,\n  height: number,\n  maxFireworks: number,\n  maxSparks: number\n) =>\n  times(maxFireworks, () => ({\n    ...initFirework(width, height),\n    sparks: generateSparks(maxSparks)\n  }))\n\nconst toRGBA = (r = 0, g = 0, b = 0, a = 1) => `rgba(${[r, g, b, a].join(',')})`\n\nconst fill = (ctx: any, x: number, y: number, colors: number[]) => {\n  ctx.beginPath()\n  ctx.fillStyle = toRGBA(...colors)\n  ctx.rect(x, y, radius, radius)\n  ctx.fill()\n}\n\nconst draw = (\n  ctx: any,\n  { phase, sparks, age, x, y }: IFirework,\n  index: number\n) => {\n  if (phase === 'fly') {\n    times(15, (i: number) => {\n      fill(ctx, x + Math.random() * i - i / 2, y + i * radius, [\n        index * 50,\n        i * 17\n      ])\n    })\n    return\n  }\n\n  sparks.forEach(spark => {\n    times(10, (i: number) => {\n      const trailAge = age + i\n      const fade = i * 20 - age * 2\n      fill(\n        ctx,\n        x + spark.vx * trailAge,\n        y + spark.vy * trailAge + (spark.weight * trailAge) ** 2,\n        ['red', 'green', 'blue'].map(key => Math.floor(spark[key] * fade))\n      )\n    })\n  })\n}\n\nconst update = (width: number, height: number, firework: IFirework) => {\n  if (firework.phase === 'explode') {\n    const others =\n      firework.age > 100 && Math.random() < 0.05\n        ? initFirework(width, height)\n        : {}\n    return { ...firework, age: firework.age + 1, ...others }\n  } else {\n    const phase =\n      Math.random() < 0.001 || firework.y < 200 ? 'explode' : firework.phase\n    return { ...firework, y: firework.y - 10, phase }\n  }\n}\n\nconst Fireworks12bius = ({\n  background,\n  width = 0,\n  height = 0,\n  maxFireworks = 0,\n  maxSparks = 0\n}: IProps) => {\n  const canvas: any = React.useRef(null)\n  const [fireworks, updator] = React.useState(\n    generateFireworks(width, height, maxFireworks, maxSparks)\n  )\n\n  React.useEffect(() => {\n    const context = canvas.current.getContext('2d')\n    context.clearRect(0, 0, width, height)\n    updator(\n      fireworks.map((firework: IFirework, index: number) => {\n        draw(context, firework, index)\n        return update(width, height, firework)\n      })\n    )\n  })\n\n  return (\n    <canvas ref={canvas} width={width} height={height} style={{ background }} />\n  )\n}\n\nFireworks12bius.defaultProps = {\n  background: 'black',\n  maxFireworks: 5,\n  maxSparks: 77\n}\n\nexport default Utils.connect({\n  component: Fireworks12bius,\n  mapStateToProps: state => ({\n    width: state.common.contentWidth,\n    height: state.common.contentHeight\n  })\n})\n"],"sourceRoot":""}