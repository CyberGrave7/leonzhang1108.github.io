{"version":3,"sources":["webpack:///./src/pages/Painting/webGL.js"],"names":["canvas","document","getElementsByClassName","width","clientWidth","height","clientHeight","config","SIM_RESOLUTION","DYE_RESOLUTION","DENSITY_DISSIPATION","VELOCITY_DISSIPATION","PRESSURE_DISSIPATION","PRESSURE_ITERATIONS","CURL","SPLAT_RADIUS","SHADING","COLORFUL","PAUSED","BACK_COLOR","r","g","b","TRANSPARENT","BLOOM","BLOOM_ITERATIONS","BLOOM_RESOLUTION","BLOOM_INTENSITY","BLOOM_THRESHOLD","BLOOM_SOFT_KNEE","pointerPrototype","this","id","x","y","dx","dy","down","moved","color","pointers","splatStack","bloomFramebuffers","push","getWebGLContext","gl","ext","params","alpha","depth","stencil","antialias","preserveDrawingBuffer","getContext","isWebGL2","halfFloat","supportLinearFiltering","getExtension","clearColor","halfFloatTexType","HALF_FLOAT","HALF_FLOAT_OES","formatRGBA","formatRG","formatR","getSupportedFormat","RGBA16F","RGBA","RG16F","RG","R16F","RED","internalFormat","format","type","supportRenderTextureFormat","texture","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MIN_FILTER","NEAREST","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","fbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","checkFramebufferStatus","FRAMEBUFFER_COMPLETE","isMobile","test","navigator","userAgent","GLProgram","vertexShader","fragmentShader","uniforms","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniformCount","ACTIVE_UNIFORMS","i","uniformName","getActiveUniform","name","getUniformLocation","useProgram","compileShader","source","shader","createShader","shaderSource","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","baseVertexShader","VERTEX_SHADER","clearShader","FRAGMENT_SHADER","colorShader","backgroundShader","displayShader","displayBloomShader","displayShadingShader","displayBloomShadingShader","bloomPrefilterShader","bloomBlurShader","bloomFinalShader","splatShader","advectionManualFilteringShader","advectionShader","divergenceShader","curlShader","vorticityShader","pressureShader","gradientSubtractShader","blit","bindBuffer","ARRAY_BUFFER","createBuffer","bufferData","Float32Array","STATIC_DRAW","ELEMENT_ARRAY_BUFFER","Uint16Array","vertexAttribPointer","FLOAT","enableVertexAttribArray","destination","drawElements","TRIANGLES","UNSIGNED_SHORT","simWidth","simHeight","dyeWidth","dyeHeight","density","velocity","divergence","curl","pressure","bloom","ditheringTexture","createTextureAsync","clearProgram","colorProgram","backgroundProgram","displayProgram","displayBloomProgram","displayShadingProgram","displayBloomShadingProgram","bloomPrefilterProgram","bloomBlurProgram","bloomFinalProgram","splatProgram","advectionProgram","divergenceProgram","curlProgram","vorticityProgram","pressureProgram","gradienSubtractProgram","initFramebuffers","simRes","getResolution","dyeRes","texType","rgba","rg","filtering","LINEAR","createDoubleFBO","resizeDoubleFBO","createFBO","initBloomFramebuffers","res","length","w","h","param","activeTexture","TEXTURE0","viewport","clear","COLOR_BUFFER_BIT","attach","fbo1","fbo2","value","swap","temp","resizeFBO","target","newFBO","bind","uniform1i","uTexture","uniform1f","read","write","REPEAT","RGB","UNSIGNED_BYTE","Uint8Array","multipleSplats","parseInt","Math","random","lastColorChangeTime","Date","now","update","resizeCanvas","input","step","render","requestAnimationFrame","pop","p","splat","generateColor","dt","disable","BLEND","uniform2f","texelSize","uVelocity","uCurl","uDivergence","uPressure","dyeTexelSize","velocityId","uSource","dissipation","applyBloom","blendFunc","ONE","ONE_MINUS_SRC_ALPHA","enable","drawingBufferWidth","drawingBufferHeight","bc","uniform4f","aspectRatio","uBloom","uDithering","scale","getTextureScale","ditherScale","last","knee","curve0","curve1","curve2","uniform3f","curve","threshold","dest","baseTex","intensity","uTarget","point","radius","amount","c","HSVtoRGB","s","v","f","q","t","floor","resolution","max","round","min","addEventListener","e","offsetX","offsetY","preventDefault","touches","targetTouches","pointer","pageX","pageY","identifier","changedTouches","j","code","key"],"mappings":"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","file":"js/3.65d08944fcfaaaa41985.bundle.js","sourcesContent":["/* eslint-disable */\n'use strict'\n\nexport default () => {\n  const canvas = document.getElementsByClassName('painting-canvas')[0]\n  canvas.width = canvas.clientWidth\n  canvas.height = canvas.clientHeight\n\n  const config = {\n    SIM_RESOLUTION: 128,\n    DYE_RESOLUTION: 512,\n    DENSITY_DISSIPATION: 0.97,\n    VELOCITY_DISSIPATION: 0.98,\n    PRESSURE_DISSIPATION: 0.8,\n    PRESSURE_ITERATIONS: 20,\n    CURL: 30,\n    SPLAT_RADIUS: 0.5,\n    SHADING: true,\n    COLORFUL: true,\n    PAUSED: false,\n    BACK_COLOR: { r: 255, g: 255, b: 255 },\n    TRANSPARENT: false,\n    BLOOM: true,\n    BLOOM_ITERATIONS: 8,\n    BLOOM_RESOLUTION: 256,\n    BLOOM_INTENSITY: 0.8,\n    BLOOM_THRESHOLD: 0.6,\n    BLOOM_SOFT_KNEE: 0.7\n  }\n\n  function pointerPrototype() {\n    this.id = -1\n    this.x = 0\n    this.y = 0\n    this.dx = 0\n    this.dy = 0\n    this.down = false\n    this.moved = false\n    this.color = [30, 0, 300]\n  }\n\n  let pointers = []\n  let splatStack = []\n  let bloomFramebuffers = []\n  pointers.push(new pointerPrototype())\n\n  const { gl, ext } = getWebGLContext(canvas)\n\n  if (isMobile()) config.SHADING = false\n  if (!ext.supportLinearFiltering) {\n    config.SHADING = false\n    config.BLOOM = false\n  }\n\n  function getWebGLContext(canvas) {\n    const params = {\n      alpha: true,\n      depth: false,\n      stencil: false,\n      antialias: false,\n      preserveDrawingBuffer: false\n    }\n\n    let gl = canvas.getContext('webgl2', params)\n    const isWebGL2 = !!gl\n    if (!isWebGL2)\n      gl =\n        canvas.getContext('webgl', params) ||\n        canvas.getContext('experimental-webgl', params)\n\n    let halfFloat\n    let supportLinearFiltering\n    if (isWebGL2) {\n      gl.getExtension('EXT_color_buffer_float')\n      supportLinearFiltering = gl.getExtension('OES_texture_float_linear')\n    } else {\n      halfFloat = gl.getExtension('OES_texture_half_float')\n      supportLinearFiltering = gl.getExtension('OES_texture_half_float_linear')\n    }\n\n    gl.clearColor(0.0, 0.0, 0.0, 1.0)\n\n    const halfFloatTexType = isWebGL2 ? gl.HALF_FLOAT : halfFloat.HALF_FLOAT_OES\n    let formatRGBA\n    let formatRG\n    let formatR\n\n    if (isWebGL2) {\n      formatRGBA = getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, halfFloatTexType)\n      formatRG = getSupportedFormat(gl, gl.RG16F, gl.RG, halfFloatTexType)\n      formatR = getSupportedFormat(gl, gl.R16F, gl.RED, halfFloatTexType)\n    } else {\n      formatRGBA = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType)\n      formatRG = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType)\n      formatR = getSupportedFormat(gl, gl.RGBA, gl.RGBA, halfFloatTexType)\n    }\n\n    return {\n      gl,\n      ext: {\n        formatRGBA,\n        formatRG,\n        formatR,\n        halfFloatTexType,\n        supportLinearFiltering\n      }\n    }\n  }\n\n  function getSupportedFormat(gl, internalFormat, format, type) {\n    if (!supportRenderTextureFormat(gl, internalFormat, format, type)) {\n      switch (internalFormat) {\n        case gl.R16F:\n          return getSupportedFormat(gl, gl.RG16F, gl.RG, type)\n        case gl.RG16F:\n          return getSupportedFormat(gl, gl.RGBA16F, gl.RGBA, type)\n        default:\n          return null\n      }\n    }\n\n    return {\n      internalFormat,\n      format\n    }\n  }\n\n  function supportRenderTextureFormat(gl, internalFormat, format, type) {\n    let texture = gl.createTexture()\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n    gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, 4, 4, 0, format, type, null)\n\n    let fbo = gl.createFramebuffer()\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo)\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    )\n\n    const status = gl.checkFramebufferStatus(gl.FRAMEBUFFER)\n    if (status != gl.FRAMEBUFFER_COMPLETE) return false\n    return true\n  }\n\n  function isMobile() {\n    return /Mobi|Android/i.test(navigator.userAgent)\n  }\n\n  class GLProgram {\n    constructor(vertexShader, fragmentShader) {\n      this.uniforms = {}\n      this.program = gl.createProgram()\n\n      gl.attachShader(this.program, vertexShader)\n      gl.attachShader(this.program, fragmentShader)\n      gl.linkProgram(this.program)\n\n      if (!gl.getProgramParameter(this.program, gl.LINK_STATUS))\n        throw gl.getProgramInfoLog(this.program)\n\n      const uniformCount = gl.getProgramParameter(\n        this.program,\n        gl.ACTIVE_UNIFORMS\n      )\n      for (let i = 0; i < uniformCount; i++) {\n        const uniformName = gl.getActiveUniform(this.program, i).name\n        this.uniforms[uniformName] = gl.getUniformLocation(\n          this.program,\n          uniformName\n        )\n      }\n    }\n\n    bind() {\n      gl.useProgram(this.program)\n    }\n  }\n\n  function compileShader(type, source) {\n    const shader = gl.createShader(type)\n    gl.shaderSource(shader, source)\n    gl.compileShader(shader)\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\n      throw gl.getShaderInfoLog(shader)\n\n    return shader\n  }\n\n  const baseVertexShader = compileShader(\n    gl.VERTEX_SHADER,\n    `\n      precision highp float;\n      attribute vec2 aPosition;\n      varying vec2 vUv;\n      varying vec2 vL;\n      varying vec2 vR;\n      varying vec2 vT;\n      varying vec2 vB;\n      uniform vec2 texelSize;\n      void main () {\n          vUv = aPosition * 0.5 + 0.5;\n          vL = vUv - vec2(texelSize.x, 0.0);\n          vR = vUv + vec2(texelSize.x, 0.0);\n          vT = vUv + vec2(0.0, texelSize.y);\n          vB = vUv - vec2(0.0, texelSize.y);\n          gl_Position = vec4(aPosition, 0.0, 1.0);\n      }\n  `\n  )\n\n  const clearShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying highp vec2 vUv;\n      uniform sampler2D uTexture;\n      uniform float value;\n      void main () {\n          gl_FragColor = value * texture2D(uTexture, vUv);\n      }\n  `\n  )\n\n  const colorShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n          gl_FragColor = color;\n      }\n  `\n  )\n\n  const backgroundShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uTexture;\n      uniform float aspectRatio;\n      #define SCALE 25.0\n      void main () {\n          vec2 uv = floor(vUv * SCALE * vec2(aspectRatio, 1.0));\n          float v = mod(uv.x + uv.y, 2.0);\n          v = v * 0.1 + 0.8;\n          gl_FragColor = vec4(vec3(v), 1.0);\n      }\n  `\n  )\n\n  const displayShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uTexture;\n      void main () {\n          vec3 C = texture2D(uTexture, vUv).rgb;\n          float a = max(C.r, max(C.g, C.b));\n          gl_FragColor = vec4(C, a);\n      }\n  `\n  )\n\n  const displayBloomShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uTexture;\n      uniform sampler2D uBloom;\n      uniform sampler2D uDithering;\n      uniform vec2 ditherScale;\n      void main () {\n          vec3 C = texture2D(uTexture, vUv).rgb;\n          vec3 bloom = texture2D(uBloom, vUv).rgb;\n          vec3 noise = texture2D(uDithering, vUv * ditherScale).rgb;\n          noise = noise * 2.0 - 1.0;\n          bloom += noise / 800.0;\n          bloom = pow(bloom.rgb, vec3(1.0 / 2.2));\n          C += bloom;\n          float a = max(C.r, max(C.g, C.b));\n          gl_FragColor = vec4(C, a);\n      }\n  `\n  )\n\n  const displayShadingShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      varying vec2 vL;\n      varying vec2 vR;\n      varying vec2 vT;\n      varying vec2 vB;\n      uniform sampler2D uTexture;\n      uniform vec2 texelSize;\n      void main () {\n          vec3 L = texture2D(uTexture, vL).rgb;\n          vec3 R = texture2D(uTexture, vR).rgb;\n          vec3 T = texture2D(uTexture, vT).rgb;\n          vec3 B = texture2D(uTexture, vB).rgb;\n          vec3 C = texture2D(uTexture, vUv).rgb;\n          float dx = length(R) - length(L);\n          float dy = length(T) - length(B);\n          vec3 n = normalize(vec3(dx, dy, length(texelSize)));\n          vec3 l = vec3(0.0, 0.0, 1.0);\n          float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);\n          C.rgb *= diffuse;\n          float a = max(C.r, max(C.g, C.b));\n          gl_FragColor = vec4(C, a);\n      }\n  `\n  )\n\n  const displayBloomShadingShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      varying vec2 vL;\n      varying vec2 vR;\n      varying vec2 vT;\n      varying vec2 vB;\n      uniform sampler2D uTexture;\n      uniform sampler2D uBloom;\n      uniform sampler2D uDithering;\n      uniform vec2 ditherScale;\n      uniform vec2 texelSize;\n      void main () {\n          vec3 L = texture2D(uTexture, vL).rgb;\n          vec3 R = texture2D(uTexture, vR).rgb;\n          vec3 T = texture2D(uTexture, vT).rgb;\n          vec3 B = texture2D(uTexture, vB).rgb;\n          vec3 C = texture2D(uTexture, vUv).rgb;\n          float dx = length(R) - length(L);\n          float dy = length(T) - length(B);\n          vec3 n = normalize(vec3(dx, dy, length(texelSize)));\n          vec3 l = vec3(0.0, 0.0, 1.0);\n          float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);\n          C *= diffuse;\n          vec3 bloom = texture2D(uBloom, vUv).rgb;\n          vec3 noise = texture2D(uDithering, vUv * ditherScale).rgb;\n          noise = noise * 2.0 - 1.0;\n          bloom += noise / 800.0;\n          bloom = pow(bloom.rgb, vec3(1.0 / 2.2));\n          C += bloom;\n          float a = max(C.r, max(C.g, C.b));\n          gl_FragColor = vec4(C, a);\n      }\n  `\n  )\n\n  const bloomPrefilterShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uTexture;\n      uniform vec3 curve;\n      uniform float threshold;\n      void main () {\n          vec3 c = texture2D(uTexture, vUv).rgb;\n          float br = max(c.r, max(c.g, c.b));\n          float rq = clamp(br - curve.x, 0.0, curve.y);\n          rq = curve.z * rq * rq;\n          c *= max(rq, br - threshold) / max(br, 0.0001);\n          gl_FragColor = vec4(c, 0.0);\n      }\n  `\n  )\n\n  const bloomBlurShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying vec2 vL;\n      varying vec2 vR;\n      varying vec2 vT;\n      varying vec2 vB;\n      uniform sampler2D uTexture;\n      void main () {\n          vec4 sum = vec4(0.0);\n          sum += texture2D(uTexture, vL);\n          sum += texture2D(uTexture, vR);\n          sum += texture2D(uTexture, vT);\n          sum += texture2D(uTexture, vB);\n          sum *= 0.25;\n          gl_FragColor = sum;\n      }\n  `\n  )\n\n  const bloomFinalShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying vec2 vL;\n      varying vec2 vR;\n      varying vec2 vT;\n      varying vec2 vB;\n      uniform sampler2D uTexture;\n      uniform float intensity;\n      void main () {\n          vec4 sum = vec4(0.0);\n          sum += texture2D(uTexture, vL);\n          sum += texture2D(uTexture, vR);\n          sum += texture2D(uTexture, vT);\n          sum += texture2D(uTexture, vB);\n          sum *= 0.25;\n          gl_FragColor = sum * intensity;\n      }\n  `\n  )\n\n  const splatShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uTarget;\n      uniform float aspectRatio;\n      uniform vec3 color;\n      uniform vec2 point;\n      uniform float radius;\n      void main () {\n          vec2 p = vUv - point.xy;\n          p.x *= aspectRatio;\n          vec3 splat = exp(-dot(p, p) / radius) * color;\n          vec3 base = texture2D(uTarget, vUv).xyz;\n          gl_FragColor = vec4(base + splat, 1.0);\n      }\n  `\n  )\n\n  const advectionManualFilteringShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uVelocity;\n      uniform sampler2D uSource;\n      uniform vec2 texelSize;\n      uniform vec2 dyeTexelSize;\n      uniform float dt;\n      uniform float dissipation;\n      vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {\n          vec2 st = uv / tsize - 0.5;\n          vec2 iuv = floor(st);\n          vec2 fuv = fract(st);\n          vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);\n          vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);\n          vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);\n          vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);\n          return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);\n      }\n      void main () {\n          vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize;\n          gl_FragColor = dissipation * bilerp(uSource, coord, dyeTexelSize);\n          gl_FragColor.a = 1.0;\n      }\n  `\n  )\n\n  const advectionShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      uniform sampler2D uVelocity;\n      uniform sampler2D uSource;\n      uniform vec2 texelSize;\n      uniform float dt;\n      uniform float dissipation;\n      void main () {\n          vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;\n          gl_FragColor = dissipation * texture2D(uSource, coord);\n          gl_FragColor.a = 1.0;\n      }\n  `\n  )\n\n  const divergenceShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying highp vec2 vUv;\n      varying highp vec2 vL;\n      varying highp vec2 vR;\n      varying highp vec2 vT;\n      varying highp vec2 vB;\n      uniform sampler2D uVelocity;\n      void main () {\n          float L = texture2D(uVelocity, vL).x;\n          float R = texture2D(uVelocity, vR).x;\n          float T = texture2D(uVelocity, vT).y;\n          float B = texture2D(uVelocity, vB).y;\n          vec2 C = texture2D(uVelocity, vUv).xy;\n          if (vL.x < 0.0) { L = -C.x; }\n          if (vR.x > 1.0) { R = -C.x; }\n          if (vT.y > 1.0) { T = -C.y; }\n          if (vB.y < 0.0) { B = -C.y; }\n          float div = 0.5 * (R - L + T - B);\n          gl_FragColor = vec4(div, 0.0, 0.0, 1.0);\n      }\n  `\n  )\n\n  const curlShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying highp vec2 vUv;\n      varying highp vec2 vL;\n      varying highp vec2 vR;\n      varying highp vec2 vT;\n      varying highp vec2 vB;\n      uniform sampler2D uVelocity;\n      void main () {\n          float L = texture2D(uVelocity, vL).y;\n          float R = texture2D(uVelocity, vR).y;\n          float T = texture2D(uVelocity, vT).x;\n          float B = texture2D(uVelocity, vB).x;\n          float vorticity = R - L - T + B;\n          gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);\n      }\n  `\n  )\n\n  const vorticityShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision highp float;\n      precision highp sampler2D;\n      varying vec2 vUv;\n      varying vec2 vL;\n      varying vec2 vR;\n      varying vec2 vT;\n      varying vec2 vB;\n      uniform sampler2D uVelocity;\n      uniform sampler2D uCurl;\n      uniform float curl;\n      uniform float dt;\n      void main () {\n          float L = texture2D(uCurl, vL).x;\n          float R = texture2D(uCurl, vR).x;\n          float T = texture2D(uCurl, vT).x;\n          float B = texture2D(uCurl, vB).x;\n          float C = texture2D(uCurl, vUv).x;\n          vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));\n          force /= length(force) + 0.0001;\n          force *= curl * C;\n          force.y *= -1.0;\n          vec2 vel = texture2D(uVelocity, vUv).xy;\n          gl_FragColor = vec4(vel + force * dt, 0.0, 1.0);\n      }\n  `\n  )\n\n  const pressureShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying highp vec2 vUv;\n      varying highp vec2 vL;\n      varying highp vec2 vR;\n      varying highp vec2 vT;\n      varying highp vec2 vB;\n      uniform sampler2D uPressure;\n      uniform sampler2D uDivergence;\n      vec2 boundary (vec2 uv) {\n          return uv;\n          // uncomment if you use wrap or repeat texture mode\n          // uv = min(max(uv, 0.0), 1.0);\n          // return uv;\n      }\n      void main () {\n          float L = texture2D(uPressure, boundary(vL)).x;\n          float R = texture2D(uPressure, boundary(vR)).x;\n          float T = texture2D(uPressure, boundary(vT)).x;\n          float B = texture2D(uPressure, boundary(vB)).x;\n          float C = texture2D(uPressure, vUv).x;\n          float divergence = texture2D(uDivergence, vUv).x;\n          float pressure = (L + R + B + T - divergence) * 0.25;\n          gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);\n      }\n  `\n  )\n\n  const gradientSubtractShader = compileShader(\n    gl.FRAGMENT_SHADER,\n    `\n      precision mediump float;\n      precision mediump sampler2D;\n      varying highp vec2 vUv;\n      varying highp vec2 vL;\n      varying highp vec2 vR;\n      varying highp vec2 vT;\n      varying highp vec2 vB;\n      uniform sampler2D uPressure;\n      uniform sampler2D uVelocity;\n      vec2 boundary (vec2 uv) {\n          return uv;\n          // uv = min(max(uv, 0.0), 1.0);\n          // return uv;\n      }\n      void main () {\n          float L = texture2D(uPressure, boundary(vL)).x;\n          float R = texture2D(uPressure, boundary(vR)).x;\n          float T = texture2D(uPressure, boundary(vT)).x;\n          float B = texture2D(uPressure, boundary(vB)).x;\n          vec2 velocity = texture2D(uVelocity, vUv).xy;\n          velocity.xy -= vec2(R - L, T - B);\n          gl_FragColor = vec4(velocity, 0.0, 1.0);\n      }\n  `\n  )\n\n  const blit = (() => {\n    gl.bindBuffer(gl.ARRAY_BUFFER, gl.createBuffer())\n    gl.bufferData(\n      gl.ARRAY_BUFFER,\n      new Float32Array([-1, -1, -1, 1, 1, 1, 1, -1]),\n      gl.STATIC_DRAW\n    )\n    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gl.createBuffer())\n    gl.bufferData(\n      gl.ELEMENT_ARRAY_BUFFER,\n      new Uint16Array([0, 1, 2, 0, 2, 3]),\n      gl.STATIC_DRAW\n    )\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0)\n    gl.enableVertexAttribArray(0)\n\n    return destination => {\n      gl.bindFramebuffer(gl.FRAMEBUFFER, destination)\n      gl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0)\n    }\n  })()\n\n  let simWidth\n  let simHeight\n  let dyeWidth\n  let dyeHeight\n  let density\n  let velocity\n  let divergence\n  let curl\n  let pressure\n  let bloom\n\n  let ditheringTexture = createTextureAsync()\n\n  const clearProgram = new GLProgram(baseVertexShader, clearShader)\n  const colorProgram = new GLProgram(baseVertexShader, colorShader)\n  const backgroundProgram = new GLProgram(baseVertexShader, backgroundShader)\n  const displayProgram = new GLProgram(baseVertexShader, displayShader)\n  const displayBloomProgram = new GLProgram(baseVertexShader, displayBloomShader)\n  const displayShadingProgram = new GLProgram(\n    baseVertexShader,\n    displayShadingShader\n  )\n  const displayBloomShadingProgram = new GLProgram(\n    baseVertexShader,\n    displayBloomShadingShader\n  )\n  const bloomPrefilterProgram = new GLProgram(\n    baseVertexShader,\n    bloomPrefilterShader\n  )\n  const bloomBlurProgram = new GLProgram(baseVertexShader, bloomBlurShader)\n  const bloomFinalProgram = new GLProgram(baseVertexShader, bloomFinalShader)\n  const splatProgram = new GLProgram(baseVertexShader, splatShader)\n  const advectionProgram = new GLProgram(\n    baseVertexShader,\n    ext.supportLinearFiltering ? advectionShader : advectionManualFilteringShader\n  )\n  const divergenceProgram = new GLProgram(baseVertexShader, divergenceShader)\n  const curlProgram = new GLProgram(baseVertexShader, curlShader)\n  const vorticityProgram = new GLProgram(baseVertexShader, vorticityShader)\n  const pressureProgram = new GLProgram(baseVertexShader, pressureShader)\n  const gradienSubtractProgram = new GLProgram(\n    baseVertexShader,\n    gradientSubtractShader\n  )\n\n  function initFramebuffers() {\n    let simRes = getResolution(config.SIM_RESOLUTION)\n    let dyeRes = getResolution(config.DYE_RESOLUTION)\n\n    simWidth = simRes.width\n    simHeight = simRes.height\n    dyeWidth = dyeRes.width\n    dyeHeight = dyeRes.height\n\n    const texType = ext.halfFloatTexType\n    const rgba = ext.formatRGBA\n    const rg = ext.formatRG\n    const r = ext.formatR\n    const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n\n    if (density == null)\n      density = createDoubleFBO(\n        dyeWidth,\n        dyeHeight,\n        rgba.internalFormat,\n        rgba.format,\n        texType,\n        filtering\n      )\n    else\n      density = resizeDoubleFBO(\n        density,\n        dyeWidth,\n        dyeHeight,\n        rgba.internalFormat,\n        rgba.format,\n        texType,\n        filtering\n      )\n\n    if (velocity == null)\n      velocity = createDoubleFBO(\n        simWidth,\n        simHeight,\n        rg.internalFormat,\n        rg.format,\n        texType,\n        filtering\n      )\n    else\n      velocity = resizeDoubleFBO(\n        velocity,\n        simWidth,\n        simHeight,\n        rg.internalFormat,\n        rg.format,\n        texType,\n        filtering\n      )\n\n    divergence = createFBO(\n      simWidth,\n      simHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    )\n    curl = createFBO(\n      simWidth,\n      simHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    )\n    pressure = createDoubleFBO(\n      simWidth,\n      simHeight,\n      r.internalFormat,\n      r.format,\n      texType,\n      gl.NEAREST\n    )\n\n    initBloomFramebuffers()\n  }\n\n  function initBloomFramebuffers() {\n    let res = getResolution(config.BLOOM_RESOLUTION)\n\n    const texType = ext.halfFloatTexType\n    const rgba = ext.formatRGBA\n    const filtering = ext.supportLinearFiltering ? gl.LINEAR : gl.NEAREST\n\n    bloom = createFBO(\n      res.width,\n      res.height,\n      rgba.internalFormat,\n      rgba.format,\n      texType,\n      filtering\n    )\n\n    bloomFramebuffers.length = 0\n    for (let i = 0; i < config.BLOOM_ITERATIONS; i++) {\n      let width = res.width >> (i + 1)\n      let height = res.height >> (i + 1)\n\n      if (width < 2 || height < 2) break\n\n      let fbo = createFBO(\n        width,\n        height,\n        rgba.internalFormat,\n        rgba.format,\n        texType,\n        filtering\n      )\n      bloomFramebuffers.push(fbo)\n    }\n  }\n\n  function createFBO(w, h, internalFormat, format, type, param) {\n    gl.activeTexture(gl.TEXTURE0)\n    let texture = gl.createTexture()\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, param)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, param)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE)\n    gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat, w, h, 0, format, type, null)\n\n    let fbo = gl.createFramebuffer()\n    gl.bindFramebuffer(gl.FRAMEBUFFER, fbo)\n    gl.framebufferTexture2D(\n      gl.FRAMEBUFFER,\n      gl.COLOR_ATTACHMENT0,\n      gl.TEXTURE_2D,\n      texture,\n      0\n    )\n    gl.viewport(0, 0, w, h)\n    gl.clear(gl.COLOR_BUFFER_BIT)\n\n    return {\n      texture,\n      fbo,\n      width: w,\n      height: h,\n      attach(id) {\n        gl.activeTexture(gl.TEXTURE0 + id)\n        gl.bindTexture(gl.TEXTURE_2D, texture)\n        return id\n      }\n    }\n  }\n\n  function createDoubleFBO(w, h, internalFormat, format, type, param) {\n    let fbo1 = createFBO(w, h, internalFormat, format, type, param)\n    let fbo2 = createFBO(w, h, internalFormat, format, type, param)\n\n    return {\n      get read() {\n        return fbo1\n      },\n      set read(value) {\n        fbo1 = value\n      },\n      get write() {\n        return fbo2\n      },\n      set write(value) {\n        fbo2 = value\n      },\n      swap() {\n        let temp = fbo1\n        fbo1 = fbo2\n        fbo2 = temp\n      }\n    }\n  }\n\n  function resizeFBO(target, w, h, internalFormat, format, type, param) {\n    let newFBO = createFBO(w, h, internalFormat, format, type, param)\n    clearProgram.bind()\n    gl.uniform1i(clearProgram.uniforms.uTexture, target.attach(0))\n    gl.uniform1f(clearProgram.uniforms.value, 1)\n    blit(newFBO.fbo)\n    return newFBO\n  }\n\n  function resizeDoubleFBO(target, w, h, internalFormat, format, type, param) {\n    target.read = resizeFBO(\n      target.read,\n      w,\n      h,\n      internalFormat,\n      format,\n      type,\n      param\n    )\n    target.write = createFBO(w, h, internalFormat, format, type, param)\n    return target\n  }\n\n  function createTextureAsync() {\n    let texture = gl.createTexture()\n    gl.bindTexture(gl.TEXTURE_2D, texture)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n    gl.texImage2D(\n      gl.TEXTURE_2D,\n      0,\n      gl.RGB,\n      1,\n      1,\n      0,\n      gl.RGB,\n      gl.UNSIGNED_BYTE,\n      new Uint8Array([255, 255, 255])\n    )\n\n    let obj = {\n      texture,\n      width: 1,\n      height: 1,\n      attach(id) {\n        gl.activeTexture(gl.TEXTURE0 + id)\n        gl.bindTexture(gl.TEXTURE_2D, texture)\n        return id\n      }\n    }\n\n    return obj\n  }\n\n  initFramebuffers()\n  multipleSplats(parseInt(Math.random() * 20) + 5)\n\n  let lastColorChangeTime = Date.now()\n\n  update()\n\n  function update() {\n    resizeCanvas()\n    input()\n    if (!config.PAUSED) step(0.016)\n    render(null)\n    requestAnimationFrame(update)\n  }\n\n  function input() {\n    if (splatStack.length > 0) multipleSplats(splatStack.pop())\n\n    for (let i = 0; i < pointers.length; i++) {\n      const p = pointers[i]\n      if (p.moved) {\n        splat(p.x, p.y, p.dx, p.dy, p.color)\n        p.moved = false\n      }\n    }\n\n    if (!config.COLORFUL) return\n\n    if (lastColorChangeTime + 100 < Date.now()) {\n      lastColorChangeTime = Date.now()\n      for (let i = 0; i < pointers.length; i++) {\n        const p = pointers[i]\n        p.color = generateColor()\n      }\n    }\n  }\n\n  function step(dt) {\n    gl.disable(gl.BLEND)\n    gl.viewport(0, 0, simWidth, simHeight)\n\n    curlProgram.bind()\n    gl.uniform2f(curlProgram.uniforms.texelSize, 1.0 / simWidth, 1.0 / simHeight)\n    gl.uniform1i(curlProgram.uniforms.uVelocity, velocity.read.attach(0))\n    blit(curl.fbo)\n\n    vorticityProgram.bind()\n    gl.uniform2f(\n      vorticityProgram.uniforms.texelSize,\n      1.0 / simWidth,\n      1.0 / simHeight\n    )\n    gl.uniform1i(vorticityProgram.uniforms.uVelocity, velocity.read.attach(0))\n    gl.uniform1i(vorticityProgram.uniforms.uCurl, curl.attach(1))\n    gl.uniform1f(vorticityProgram.uniforms.curl, config.CURL)\n    gl.uniform1f(vorticityProgram.uniforms.dt, dt)\n    blit(velocity.write.fbo)\n    velocity.swap()\n\n    divergenceProgram.bind()\n    gl.uniform2f(\n      divergenceProgram.uniforms.texelSize,\n      1.0 / simWidth,\n      1.0 / simHeight\n    )\n    gl.uniform1i(divergenceProgram.uniforms.uVelocity, velocity.read.attach(0))\n    blit(divergence.fbo)\n\n    clearProgram.bind()\n    gl.uniform1i(clearProgram.uniforms.uTexture, pressure.read.attach(0))\n    gl.uniform1f(clearProgram.uniforms.value, config.PRESSURE_DISSIPATION)\n    blit(pressure.write.fbo)\n    pressure.swap()\n\n    pressureProgram.bind()\n    gl.uniform2f(\n      pressureProgram.uniforms.texelSize,\n      1.0 / simWidth,\n      1.0 / simHeight\n    )\n    gl.uniform1i(pressureProgram.uniforms.uDivergence, divergence.attach(0))\n    for (let i = 0; i < config.PRESSURE_ITERATIONS; i++) {\n      gl.uniform1i(pressureProgram.uniforms.uPressure, pressure.read.attach(1))\n      blit(pressure.write.fbo)\n      pressure.swap()\n    }\n\n    gradienSubtractProgram.bind()\n    gl.uniform2f(\n      gradienSubtractProgram.uniforms.texelSize,\n      1.0 / simWidth,\n      1.0 / simHeight\n    )\n    gl.uniform1i(\n      gradienSubtractProgram.uniforms.uPressure,\n      pressure.read.attach(0)\n    )\n    gl.uniform1i(\n      gradienSubtractProgram.uniforms.uVelocity,\n      velocity.read.attach(1)\n    )\n    blit(velocity.write.fbo)\n    velocity.swap()\n\n    advectionProgram.bind()\n    gl.uniform2f(\n      advectionProgram.uniforms.texelSize,\n      1.0 / simWidth,\n      1.0 / simHeight\n    )\n    if (!ext.supportLinearFiltering)\n      gl.uniform2f(\n        advectionProgram.uniforms.dyeTexelSize,\n        1.0 / simWidth,\n        1.0 / simHeight\n      )\n    let velocityId = velocity.read.attach(0)\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, velocityId)\n    gl.uniform1i(advectionProgram.uniforms.uSource, velocityId)\n    gl.uniform1f(advectionProgram.uniforms.dt, dt)\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.VELOCITY_DISSIPATION\n    )\n    blit(velocity.write.fbo)\n    velocity.swap()\n\n    gl.viewport(0, 0, dyeWidth, dyeHeight)\n\n    if (!ext.supportLinearFiltering)\n      gl.uniform2f(\n        advectionProgram.uniforms.dyeTexelSize,\n        1.0 / dyeWidth,\n        1.0 / dyeHeight\n      )\n    gl.uniform1i(advectionProgram.uniforms.uVelocity, velocity.read.attach(0))\n    gl.uniform1i(advectionProgram.uniforms.uSource, density.read.attach(1))\n    gl.uniform1f(\n      advectionProgram.uniforms.dissipation,\n      config.DENSITY_DISSIPATION\n    )\n    blit(density.write.fbo)\n    density.swap()\n  }\n\n  function render(target) {\n    if (config.BLOOM) applyBloom(density.read, bloom)\n\n    if (target == null || !config.TRANSPARENT) {\n      gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA)\n      gl.enable(gl.BLEND)\n    } else {\n      gl.disable(gl.BLEND)\n    }\n\n    let width = target == null ? gl.drawingBufferWidth : dyeWidth\n    let height = target == null ? gl.drawingBufferHeight : dyeHeight\n\n    gl.viewport(0, 0, width, height)\n\n    if (!config.TRANSPARENT) {\n      colorProgram.bind()\n      let bc = config.BACK_COLOR\n      gl.uniform4f(\n        colorProgram.uniforms.color,\n        bc.r / 255,\n        bc.g / 255,\n        bc.b / 255,\n        1\n      )\n      blit(target)\n    }\n\n    if (target == null && config.TRANSPARENT) {\n      backgroundProgram.bind()\n      gl.uniform1f(\n        backgroundProgram.uniforms.aspectRatio,\n        canvas.width / canvas.height\n      )\n      blit(null)\n    }\n\n    if (config.SHADING) {\n      let program = config.BLOOM\n        ? displayBloomShadingProgram\n        : displayShadingProgram\n      program.bind()\n      gl.uniform2f(program.uniforms.texelSize, 1.0 / width, 1.0 / height)\n      gl.uniform1i(program.uniforms.uTexture, density.read.attach(0))\n      if (config.BLOOM) {\n        gl.uniform1i(program.uniforms.uBloom, bloom.attach(1))\n        gl.uniform1i(program.uniforms.uDithering, ditheringTexture.attach(2))\n        let scale = getTextureScale(ditheringTexture, width, height)\n        gl.uniform2f(program.uniforms.ditherScale, scale.x, scale.y)\n      }\n    } else {\n      let program = config.BLOOM ? displayBloomProgram : displayProgram\n      program.bind()\n      gl.uniform1i(program.uniforms.uTexture, density.read.attach(0))\n      if (config.BLOOM) {\n        gl.uniform1i(program.uniforms.uBloom, bloom.attach(1))\n        gl.uniform1i(program.uniforms.uDithering, ditheringTexture.attach(2))\n        let scale = getTextureScale(ditheringTexture, width, height)\n        gl.uniform2f(program.uniforms.ditherScale, scale.x, scale.y)\n      }\n    }\n\n    blit(target)\n  }\n\n  function applyBloom(source, destination) {\n    if (bloomFramebuffers.length < 2) return\n\n    let last = destination\n\n    gl.disable(gl.BLEND)\n    bloomPrefilterProgram.bind()\n    let knee = config.BLOOM_THRESHOLD * config.BLOOM_SOFT_KNEE + 0.0001\n    let curve0 = config.BLOOM_THRESHOLD - knee\n    let curve1 = knee * 2\n    let curve2 = 0.25 / knee\n    gl.uniform3f(bloomPrefilterProgram.uniforms.curve, curve0, curve1, curve2)\n    gl.uniform1f(bloomPrefilterProgram.uniforms.threshold, config.BLOOM_THRESHOLD)\n    gl.uniform1i(bloomPrefilterProgram.uniforms.uTexture, source.attach(0))\n    gl.viewport(0, 0, last.width, last.height)\n    blit(last.fbo)\n\n    bloomBlurProgram.bind()\n    for (let i = 0; i < bloomFramebuffers.length; i++) {\n      let dest = bloomFramebuffers[i]\n      gl.uniform2f(\n        bloomBlurProgram.uniforms.texelSize,\n        1.0 / last.width,\n        1.0 / last.height\n      )\n      gl.uniform1i(bloomBlurProgram.uniforms.uTexture, last.attach(0))\n      gl.viewport(0, 0, dest.width, dest.height)\n      blit(dest.fbo)\n      last = dest\n    }\n\n    gl.blendFunc(gl.ONE, gl.ONE)\n    gl.enable(gl.BLEND)\n\n    for (let i = bloomFramebuffers.length - 2; i >= 0; i--) {\n      let baseTex = bloomFramebuffers[i]\n      gl.uniform2f(\n        bloomBlurProgram.uniforms.texelSize,\n        1.0 / last.width,\n        1.0 / last.height\n      )\n      gl.uniform1i(bloomBlurProgram.uniforms.uTexture, last.attach(0))\n      gl.viewport(0, 0, baseTex.width, baseTex.height)\n      blit(baseTex.fbo)\n      last = baseTex\n    }\n\n    gl.disable(gl.BLEND)\n    bloomFinalProgram.bind()\n    gl.uniform2f(\n      bloomFinalProgram.uniforms.texelSize,\n      1.0 / last.width,\n      1.0 / last.height\n    )\n    gl.uniform1i(bloomFinalProgram.uniforms.uTexture, last.attach(0))\n    gl.uniform1f(bloomFinalProgram.uniforms.intensity, config.BLOOM_INTENSITY)\n    gl.viewport(0, 0, destination.width, destination.height)\n    blit(destination.fbo)\n  }\n\n  function splat(x, y, dx, dy, color) {\n    gl.viewport(0, 0, simWidth, simHeight)\n    splatProgram.bind()\n    gl.uniform1i(splatProgram.uniforms.uTarget, velocity.read.attach(0))\n    gl.uniform1f(splatProgram.uniforms.aspectRatio, canvas.width / canvas.height)\n    gl.uniform2f(\n      splatProgram.uniforms.point,\n      x / canvas.width,\n      1.0 - y / canvas.height\n    )\n    gl.uniform3f(splatProgram.uniforms.color, dx, -dy, 1.0)\n    gl.uniform1f(splatProgram.uniforms.radius, config.SPLAT_RADIUS / 100.0)\n    blit(velocity.write.fbo)\n    velocity.swap()\n\n    gl.viewport(0, 0, dyeWidth, dyeHeight)\n    gl.uniform1i(splatProgram.uniforms.uTarget, density.read.attach(0))\n    gl.uniform3f(splatProgram.uniforms.color, color.r, color.g, color.b)\n    blit(density.write.fbo)\n    density.swap()\n  }\n\n  function multipleSplats(amount) {\n    for (let i = 0; i < amount; i++) {\n      const color = generateColor()\n      color.r *= 10.0\n      color.g *= 10.0\n      color.b *= 10.0\n      const x = canvas.width * Math.random()\n      const y = canvas.height * Math.random()\n      const dx = 1000 * (Math.random() - 0.5)\n      const dy = 1000 * (Math.random() - 0.5)\n      splat(x, y, dx, dy, color)\n    }\n  }\n\n  function resizeCanvas() {\n    if (\n      canvas.width != canvas.clientWidth ||\n      canvas.height != canvas.clientHeight\n    ) {\n      canvas.width = canvas.clientWidth\n      canvas.height = canvas.clientHeight\n      initFramebuffers()\n    }\n  }\n\n  canvas.addEventListener('mousemove', e => {\n    pointers[0].moved = pointers[0].down\n    pointers[0].dx = (e.offsetX - pointers[0].x) * 5.0\n    pointers[0].dy = (e.offsetY - pointers[0].y) * 5.0\n    pointers[0].x = e.offsetX\n    pointers[0].y = e.offsetY\n  })\n\n  canvas.addEventListener(\n    'touchmove',\n    e => {\n      e.preventDefault()\n      const touches = e.targetTouches\n      for (let i = 0; i < touches.length; i++) {\n        let pointer = pointers[i]\n        pointer.moved = pointer.down\n        pointer.dx = (touches[i].pageX - pointer.x) * 8.0\n        pointer.dy = (touches[i].pageY - pointer.y) * 8.0\n        pointer.x = touches[i].pageX\n        pointer.y = touches[i].pageY\n      }\n    },\n    false\n  )\n\n  canvas.addEventListener('mousedown', () => {\n    pointers[0].down = true\n    pointers[0].color = generateColor()\n  })\n\n  canvas.addEventListener('touchstart', e => {\n    e.preventDefault()\n    const touches = e.targetTouches\n    for (let i = 0; i < touches.length; i++) {\n      if (i >= pointers.length) pointers.push(new pointerPrototype())\n\n      pointers[i].id = touches[i].identifier\n      pointers[i].down = true\n      pointers[i].x = touches[i].pageX\n      pointers[i].y = touches[i].pageY\n      pointers[i].color = generateColor()\n    }\n  })\n\n  canvas.addEventListener('mouseup', () => {\n    pointers[0].down = false\n  })\n\n  canvas.addEventListener('touchend', e => {\n    const touches = e.changedTouches\n    for (let i = 0; i < touches.length; i++)\n      for (let j = 0; j < pointers.length; j++)\n        if (touches[i].identifier == pointers[j].id) pointers[j].down = false\n  })\n\n  canvas.addEventListener('keydown', e => {\n    if (e.code === 'KeyP') config.PAUSED = !config.PAUSED\n    if (e.key === ' ') splatStack.push(parseInt(Math.random() * 20) + 5)\n  })\n\n  function generateColor() {\n    let c = HSVtoRGB(Math.random(), 1.0, 1.0)\n    c.r *= 0.15\n    c.g *= 0.15\n    c.b *= 0.15\n    return c\n  }\n\n  function HSVtoRGB(h, s, v) {\n    let r, g, b, i, f, p, q, t\n    i = Math.floor(h * 6)\n    f = h * 6 - i\n    p = v * (1 - s)\n    q = v * (1 - f * s)\n    t = v * (1 - (1 - f) * s)\n\n    switch (i % 6) {\n      case 0:\n        ;(r = v), (g = t), (b = p)\n        break\n      case 1:\n        ;(r = q), (g = v), (b = p)\n        break\n      case 2:\n        ;(r = p), (g = v), (b = t)\n        break\n      case 3:\n        ;(r = p), (g = q), (b = v)\n        break\n      case 4:\n        ;(r = t), (g = p), (b = v)\n        break\n      case 5:\n        ;(r = v), (g = p), (b = q)\n        break\n    }\n\n    return {\n      r,\n      g,\n      b\n    }\n  }\n\n  function getResolution(resolution) {\n    let aspectRatio = gl.drawingBufferWidth / gl.drawingBufferHeight\n    if (aspectRatio < 1) aspectRatio = 1.0 / aspectRatio\n\n    let max = Math.round(resolution * aspectRatio)\n    let min = Math.round(resolution)\n\n    if (gl.drawingBufferWidth > gl.drawingBufferHeight)\n      return { width: max, height: min }\n    else return { width: min, height: max }\n  }\n\n  function getTextureScale(texture, width, height) {\n    return {\n      x: width / texture.width,\n      y: height / texture.height\n    }\n  }\n}\n"],"sourceRoot":""}