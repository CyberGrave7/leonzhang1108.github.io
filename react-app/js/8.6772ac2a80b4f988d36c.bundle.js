(window.webpackJsonp=window.webpackJsonp||[]).push([[8,38,39,40,41,42,43,61],{164:function(t,e,n){"use strict";n.r(e);var o,r=n(384),a=n.n(r),i=(n(383),n(1)),s=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this.props,e=t.percent,n=t.formatPercent,o=t.loadingFail;return i.createElement("div",{className:"loading-mask"},0!==e||o?o?"":i.createElement(a.a,{type:"circle",percent:Number(e)?e:0,format:n,status:o?"exception":100===Number(e)?"success":"active",className:o||100!==Number(e)?"":"loading"}):i.createElement("div",{className:"loader"}))},e}(i.Component);e.default=u},165:function(t,e,n){"use strict";n.r(e);var o,r=n(1),a=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.doInterval=function(){e.interval=setInterval(function(){e.intervalContent()},3e3)},e.intervalContent=function(){var t=e.state,n=t.onOff,o=t.offsetWidth;e.setState({onOff:!n,offset:n?0:o})},e.clearInterval=function(){e.interval&&clearInterval(e.interval)},e}return a(e,t),e.prototype.componentWillMount=function(){this.setState({width:0,offset:0,onOff:!1,offsetWidth:0})},e.prototype.componentDidMount=function(){this.setState({wrapperWidth:this.wrapper.offsetWidth}),this.doInterval()},e.prototype.componentWillUnmount=function(){this.clearInterval()},e.prototype.componentWillReceiveProps=function(){var t=this.state.width;if(this.dom.offsetWidth!==t){var e=this.wrapper.offsetWidth-this.dom.offsetWidth;e=e<=0?e:0,this.setState({width:this.dom.offsetWidth,offsetWidth:e,onOff:!1})}},e.prototype.render=function(){var t=this,e=this.props.musicName,n=this.state,o=n.offset,a=n.offsetWidth;return r.createElement("div",{className:"music-name "+(0===a?"flex":""),ref:function(e){t.wrapper=e}},r.createElement("div",{style:{transform:"translateX("+o+"px)"},className:"content",ref:function(e){t.dom=e}},e))},e}(r.Component);e.default=i},166:function(t,e,n){"use strict";n.r(e);var o,r=n(338),a=n.n(r),i=(n(337),n(1)),s=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this.props,e=t.totalTime,n=t.slideDuration,o=t.durationOffset,r=t.curr,s=t.durationChanging,u=t.durationChanged,c=t.formatTime;return i.createElement("div",{className:"time-zone"},i.createElement(a.a,{className:"duration-slider",value:e?(parseInt((n||o)+"",10)+r)%100:0,onChange:s,onAfterChange:u,tipFormatter:null}),i.createElement("div",null,c()))},e}(i.Component);e.default=u},167:function(t,e,n){"use strict";n.r(e),e.default={draw:function(t){var e=t.ctx,n=t.height,o=t.width,r=t.bars,a=t.barColor;return function(t,i){var s=i;if(e.clearRect(0,0,o,n),Array.isArray(a)){var u=e.createLinearGradient(0,0,0,n),c=a.length;a.forEach(function(t,e){u.addColorStop(e/(c-1),t)}),e.fillStyle=u}else e.fillStyle=a;for(var l=o/r,f=.5*l,d=Math.min(f,10)*s,p=0;p<r;p++){var m=t[p]/256*n*s,h=t[p]>0?Math.min(m+40,n-d):0;e.fillRect(l*p,n-m,f,m),e.fillRect(l*p,n-(h+d),f,d)}}}}},168:function(t,e,n){"use strict";n.r(e);var o=n(110),r=n.n(o),a=function(t){var e=this,n=t.draw,o=t.size,a=t.volume,i=t.currentTime;this.initAC=function(){e.ac=new AudioContext,e.gainNode=e.ac.createGain(),e.gainNode.gain.value=e.volume,e.gainNode.connect(e.ac.destination),e.analyser=e.ac.createAnalyser(),e.analyser.fftSize=2*e.size,e.analyser.connect(e.gainNode)},this.load=function(t,n,o){e.abort(),r()({url:t,responseType:"arraybuffer",onDownloadProgress:function(t){var e=t.loaded,n=t.total;o(e/n*100)},cancelToken:new r.a.CancelToken(function(t){e.axiosCancellation=t})}).then(function(t){n(t.data)}).catch(function(t){r.a.isCancel(t)?console.log("Request canceled",t.message):o("error")})},this.abort=function(){return e.axiosCancellation&&e.axiosCancellation("abort")},this.play=function(t){var n=t.src,o=t.cb,r=t.progressCb,a=++e.count;e.source&&e.source.stop();var i=function(t){if(e.buffer=t,a===e.count&&e.ac)try{e.createBufferSource({buffer:t},o)}catch(t){console.log(t)}};n instanceof ArrayBuffer?e.ac.decodeAudioData(n,i):e.load(n,function(t){e.ac.decodeAudioData(t,i)},r)},this.createBufferSource=function(t,n){var o=t.buffer,r=t.start,a=void 0===r?0:r;if(e.source&&e.source.stop(),e.buffer){var i=e.ac.createBufferSource();i.buffer=e.buffer=o,i.loop=!0,i.connect(e.analyser),i.start(0,a),e.source=i,e.visualize(),n&&n()}},this.updateVolume=function(t){console.log(t),e.gainNode.gain.value=e.volume=t},this.visualize=function(){var t=new Uint8Array(e.analyser.frequencyBinCount),n=window.requestAnimationFrame,o=function(){e.analyser.getByteFrequencyData(t),e.draw(t,e.volume),e.rafId=n(o)};o()},this.setCurrent=function(t){void 0===t&&(t=0);var n=e.buffer;e.curr=0,e.createBufferSource({buffer:n,start:t}),e.setInterval(!0)},this.setInterval=function(t){e.interval&&clearInterval(e.interval),t&&e.setCurrTime(t),e.interval=setInterval(function(){e.setCurrTime()},1e3)},this.setCurrTime=function(t){var n=e.buffer?e.buffer.duration.toFixed(0):0;e.currentTime({curr:t?0:++e.curr,total:n})},this.pause=function(){e.ac.suspend(),window.cancelAnimationFrame(e.rafId),e.interval&&clearInterval(e.interval)},this.resume=function(){e.ac.resume(),e.visualize(),e.setInterval()},this.stop=function(){e.abort(),e.ac.close(),window.cancelAnimationFrame(e.rafId)},this.source=null,this.count=0,this.draw=n,this.size=o,this.volume=a,this.currentTime=i,this.initAC()};e.default=a},169:function(t,e,n){"use strict";n.r(e);var o,r=n(338),a=n.n(r),i=(n(337),n(1)),s=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e.prototype.render=function(){var t=this.props,e=t.changeVolume,n=t.togglePause,o=t.pause,r=t.setMute,s=t.mute;return i.createElement("div",{className:"volume-zone"},i.createElement("div",{className:"icon anticon anticon-ts-app icon-"+(s?"mute":"volume"),onClick:r}),i.createElement(a.a,{className:"slider",defaultValue:77,onChange:e,tipFormatter:null,disabled:s}),i.createElement("div",{onClick:n,className:"icon anticon anticon-ts-app icon-"+(o?"play":"pause")}))},e}(i.Component);e.default=u},305:function(t,e,n){},77:function(t,e,n){"use strict";n.r(e);var o,r=n(9),a=n(1),i=n(164),s=n(165),u=(n(305),n(166)),c=n(167),l=n(168),f=n(169),d=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});window.AudioContext=window.AudioContext||void 0;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.visibilityChange=function(){var t=e.state.visualizer;"hidden"===document.visibilityState?(t.pause(),e.setState({pause:!0})):(t.resume(),e.setState({pause:!1}))},e.resize=function(){var t=e.state,n=t.width,o=t.height,r=e.canvas;r.width=n,r.height=o},e.play=function(t){var n=e.state.src;t?e.state.visualizer.play(t):r.a.isString(n)&&e.state.visualizer.play({src:n,cb:e.afterLoading,progressCb:e.progress})},e.progress=function(t){e.mounted&&(isNaN(t)?e.setState({percent:0,loadingFail:!0,showAdd:!0}):e.setState({percent:t,showAdd:!0}))},e.afterLoading=function(){e.setState({loading:!1,showAdd:!0},function(){e.state.visualizer.setCurrent(0)})},e.restartVisualizer=function(){if(e.state.compatible){var t=e.canvas.getContext("2d"),n=e.state,o=n.height,r=n.width,a=n.bars,i=n.barColor,s=n.volume,u={ctx:t,height:o,width:r,bars:a,barColor:i},f=e.currentTime;e.setState({visualizer:new l.default({size:a,draw:c.default.draw(u),volume:s,currentTime:f})},e.play),e.resize()}},e.currentTime=function(t){var n=t.curr,o=t.total;e.mounted&&e.setState({currentTime:n,totalTime:o})},e.changeVolume=function(t){e.state.visualizer.updateVolume(t/100)},e.togglePause=function(){var t=e.state,n=t.visualizer,o=t.pause;o?n.resume():n.pause(),e.setState({pause:!o})},e.formatPercent=function(t){return 100===t?"decoding":e.state.loadingFail?"â†“":t.toFixed(1)+"%"},e.formatTime=function(){var t=e.state,n=t.currentTime,o=t.totalTime,a=t.durationOffset,i=t.slideDuration;return r.a.secondFormatToTime(o?(n%o+e.durationToSecond(i||a))%o:0)+" / "+r.a.secondFormatToTime(o)},e.durationChanging=function(t){e.setState({slideDuration:t,currentTime:0})},e.durationChanged=function(t){e.setState({slideDuration:null,durationOffset:t,pause:!1,currentTime:0},function(){e.state.visualizer.setCurrent(e.durationToSecond(t)),e.state.visualizer.resume()})},e.durationToSecond=function(t){return parseInt((t/100*e.state.totalTime).toFixed(0),10)},e.fileChange=function(){e.input.files[0]&&(e.state.visualizer.abort(),e.setState({showAdd:!1,percent:0},function(){var t=new FileReader,n=e.input.files[0].name;t.readAsArrayBuffer(e.input.files[0]),t.onload=function(t){e.play({src:t.currentTarget.result,cb:e.afterLoading,progressCb:e.progress}),e.setState({loadingFail:!1,loading:!0,durationOffset:0,musicName:n})}}))},e.setMute=function(){var t=e.state.mute;e.setState({mute:!t},function(){var t=e.state,n=t.mute,o=t.volume;e.changeVolume(n?0:100*o)})},e}return d(e,t),e.prototype.componentWillMount=function(){document.addEventListener("visibilitychange",this.visibilityChange),this.setState({src:"NoMusic",bars:64,barColor:["gold","aqua"],height:this.props.isMobile?.5*this.props.h:400,width:this.props.isMobile?300:600,pause:!1,volume:.77,loading:!0,percent:0,totalTime:0,currentTime:0,durationOffset:0,slideDuration:null,loadingFail:!1,compatible:!!window.AudioContext,showAdd:!1,musicName:"",mute:!1}),this.mounted=!0},e.prototype.componentDidMount=function(){this.restartVisualizer()},e.prototype.componentWillUnmount=function(){this.state.visualizer.stop(),document.removeEventListener("visibilitychange",this.visibilityChange),this.mounted=!1},e.prototype.render=function(){var t=this,e=this.state,n=e.pause,o=e.loading,r=e.percent,c=e.durationOffset,l=e.slideDuration,d=e.currentTime,p=e.totalTime,m=e.loadingFail,h=e.compatible,v=e.showAdd,g=e.musicName,y=e.mute;if(!h)return a.createElement("div",{className:"music-visualizer"},"not compatible");var b=p?parseInt((d%p/p*100).toFixed(0),10):0;return a.createElement("div",{className:"music-visualizer "+(o?"loading":"loaded")},a.createElement("canvas",{ref:function(e){t.canvas=e}}),a.createElement(s.default,{musicName:g}),o?"":a.createElement(f.default,{pause:n,mute:y,setMute:this.setMute,togglePause:this.togglePause,changeVolume:this.changeVolume}),o?"":a.createElement(u.default,{curr:b,totalTime:p,formatTime:this.formatTime,slideDuration:l,durationOffset:c,durationChanged:this.durationChanged,durationChanging:this.durationChanging}),o?a.createElement(i.default,{percent:r,formatPercent:this.formatPercent,loadingFail:m}):"",a.createElement("a",{href:"javascript:;",className:"upload "+(v?"":"disappear")},a.createElement("div",{className:"anticon anticon-ts-app icon-add"}),a.createElement("input",{className:"change",ref:function(e){t.input=e},type:"file",accept:"audio/mpeg",onChange:this.fileChange})))},e}(a.Component);e.default=r.a.connect({component:p,mapStateToProps:function(t){return{isMobile:t.common.isMobile,h:t.common.contentHeight}}})}}]);
//# sourceMappingURL=8.6772ac2a80b4f988d36c.bundle.js.map