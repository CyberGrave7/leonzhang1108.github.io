{"version":3,"sources":["webpack:///./src/pages/12bius/index.tsx"],"names":["times","n","func","Array","fill","map","_","i","initFirework","width","height","age","phase","x","Math","floor","random","y","generateSparks","maxSparks","vx","vy","blue","green","red","weight","ctx","colors","beginPath","fillStyle","r","g","b","a","join","rect","Fireworks12bius","background","maxFireworks","canvas","useRef","sparks","fireworks","updator","useEffect","context","current","getContext","clearRect","setTimeout","firework","index","forEach","spark","trailAge","fade","key","draw","others","update","ref","style","defaultProps","connect","component","mapStateToProps","state","common","contentWidth","contentHeight"],"mappings":"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","file":"js/27.840bdd394f16ce958097.bundle.js","sourcesContent":["import Utils from '@utils'\nimport React from 'react'\ninterface IProps {\n  background?: string\n  width?: number\n  height?: number\n  maxFireworks?: number\n  maxSparks?: number\n}\n\ninterface ISpark {\n  vx: number\n  vy: number\n  weight: number\n  red: number\n  green: number\n  blue: number\n}\n\ninterface IFirework {\n  x: number\n  y: number\n  age: number\n  phase: 'fly' | 'explode'\n  sparks: ISpark[]\n}\n\nconst radius = 5\n\nconst times = (n: number, func: (v: number) => any) =>\n  Array(n)\n    .fill(null)\n    .map((_, i) => func(i))\n\nconst initFirework = (width: number, height: number) => {\n  return {\n    age: 0,\n    phase: 'fly',\n    x: Math.floor(Math.random() * width),\n    y: height\n  }\n}\n\nconst generateSparks = (maxSparks: number) => {\n  return times(maxSparks, (i: number) => {\n    const vx = Math.random() * 5 + 0.5\n    const vy = Math.random() * 5 + 0.5\n\n    return {\n      blue: Math.floor(Math.random() * 2),\n      green: Math.floor(Math.random() * 2),\n      red: Math.floor(Math.random() * 2),\n      vx: Math.random() > 0.5 ? -vx : vx,\n      vy: Math.random() > 0.5 ? -vy : vy,\n      weight: Math.random() * 0.3 + 0.03\n    }\n  })\n}\n\nconst generateFireworks = (\n  width: number,\n  height: number,\n  maxFireworks: number,\n  maxSparks: number\n) => times(maxFireworks, () => ({\n  ...initFirework(width, height),\n  sparks: generateSparks(maxSparks)\n}))\n\nconst toRGBA = (r = 0, g = 0, b = 0, a = 1) => `rgba(${[r, g, b, a].join(',')})`\n\nconst fill = (ctx: any, x: number, y: number, colors: number[]) => {\n  ctx.beginPath()\n  ctx.fillStyle = toRGBA(...colors)\n  ctx.rect(x, y, radius, radius)\n  ctx.fill()\n}\n\nconst draw = (ctx: any, { phase, sparks, age, x, y }: IFirework, index: number) => {\n  if (phase === 'fly') {\n    times(15, (i: number) => {\n      fill(ctx, x + Math.random() * i - i / 2, y + i * radius, [index * 50, i * 17])\n    })\n    return\n  }\n\n  sparks.forEach(spark => {\n    times(10, (i: number) => {\n      const trailAge = age + i\n      const fade = i * 20 - age * 2\n      fill(\n        ctx,\n        x + spark.vx * trailAge,\n        y + spark.vy * trailAge + (spark.weight * trailAge) ** 2,\n        ['red', 'green', 'blue'].map(key => Math.floor(spark[key] * fade))\n      )\n    })\n  })\n}\n\nconst update = (width: number, height: number, firework: IFirework) => {\n  if (firework.phase === 'explode') {\n    const others = firework.age > 100 && Math.random() < 0.05 ? initFirework(width, height) : {}\n    return { ...firework, age: firework.age + 1, ...others }\n  } else {\n    const phase = Math.random() < 0.001 || firework.y < 200 ? 'explode' : firework.phase\n    return { ...firework, y: firework.y - 10, phase }\n  }\n}\n\nconst Fireworks12bius = ({ background, width = 0, height = 0, maxFireworks = 0, maxSparks = 0 }: IProps) => {\n  const canvas: any = React.useRef(null)\n  const [fireworks, updator] = React.useState(\n    generateFireworks(width, height, maxFireworks, maxSparks)\n  )\n\n  React.useEffect(() => {\n    const context = canvas.current.getContext('2d')\n    context.clearRect(0, 0, width, height)\n    const updatorFunc = () => updator(\n      fireworks.map((firework: IFirework, index: number) => {\n        draw(context, firework, index)\n        return update(width, height, firework)\n      })\n    )\n    setTimeout(updatorFunc, 0)\n  })\n\n  return <canvas ref={canvas} width={width} height={height} style={{ background }} />\n}\n\nFireworks12bius.defaultProps = {\n  background: 'black',\n  maxFireworks: 5,\n  maxSparks: 77\n}\n\nexport default Utils.connect({\n  component: Fireworks12bius,\n  mapStateToProps: state => ({\n    width: state.common.contentWidth,\n    height: state.common.contentHeight\n  })\n})\n"],"sourceRoot":""}