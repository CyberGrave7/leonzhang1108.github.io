{"version":3,"sources":["webpack:///./src/pages/2048/tools.tsx","webpack:///./node_modules/css-animation/lib/Event.js","webpack:///./src/constant/common.ts","webpack:///./src/pages/2048/index.tsx"],"names":["getValue","x","y","p","res","v","index","some","i","same","moveRight","changed","max","curr","occupied","currV","nextV","currIndex","merged","nextIndex","push","id","Math","random","moveLeft","min","moveDown","moveUp","Object","defineProperty","exports","value","START_EVENT_NAME_MAP","transitionstart","transition","WebkitTransition","MozTransition","OTransition","msTransition","animationstart","animation","WebkitAnimation","MozAnimation","OAnimation","msAnimation","END_EVENT_NAME_MAP","transitionend","animationend","startEvents","endEvents","addEventListener","node","eventName","eventListener","removeEventListener","window","document","style","createElement","process","EVENT_NAME_MAP","events","baseEventName","hasOwnProperty","baseEvents","styleName","detectEvents","TransitionEvents","addStartEventListener","length","forEach","startEvent","setTimeout","removeStartEventListener","addEndEventListener","endEvent","removeEndEventListener","module","keyCode","left","up","right","down","storage","Storage","props","reset","pieces","isInited","isArray","addRandom","set","state","size","cached","setState","removeMerged","f","filter","touchstart","e","pageX","pageY","touchmove","preventDefault","touchend","code","abs","sx","ex","sy","ey","doMove","keydown","dp","lp","rp","isReset","setStorage","doAddRandom","clone","item","get4or2","renderGrid","Array","fill","map","v1","className","key","v2","isGameOver","list","canMove","data","r","c","get","componentDidMount","this","componentWillUnmount","render","type","title","onConfirm","handle","okText","cancelText","Component"],"mappings":"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","file":"js/11.bcabb6b0eb142b17b128.bundle.js","sourcesContent":["interface IPiece {\n  x: number,\n  y: number,\n  v: number,\n  merged?: boolean,\n  id: number\n}\n\nconst getValue = (x, y, p) => {\n  let res = { v: 0, index: -1 }\n  p.some((i, index) => {\n    const same = i.x === x && i.y === y\n    if (same) { res = { v: i.v, index } }\n    return same\n  })\n  return res\n}\n\nexport default {\n  moveRight: (p: IPiece[]) => {\n    let changed = false\n    for (let y = 0; y < 4; y++) {\n      let max = 3\n      for (let x = 2; x >= 0; x--) {\n        let curr = -1\n        const isOccupied = p.some((i, index) => {\n          const occupied = i.x === (x + 1) && i.y === y\n          if (i.x === x && i.y === y) { curr = index }\n          if (occupied) { max-- }\n          return occupied\n        })\n        if (!isOccupied && curr >= 0) {\n          p[curr].x = max\n          changed = true\n          max--\n        }\n      }\n      for (let x = 2; x >= 0; x--) {\n        const { v: currV, index: currIndex } = getValue(x, y, p)\n        const { v: nextV, index: nextIndex } = getValue(x + 1, y, p)\n        if (currV && nextV && currV === nextV) {\n          p[currIndex].x = x + 1\n          p[currIndex].merged = true\n          p[nextIndex].merged = true\n          for (let v = x - 1; v >= 0; v--) {\n            const { index: i } = getValue(v, y, p)\n            if (i >= 0) { p[i].x = p[i].x < 3 ? p[i].x + 1 : p[i].x }\n          }\n          p.push({ x: x + 1, y, v: currV * 2, id: Math.random() })\n          changed = true\n        }\n      }\n    }\n    return { p, changed }\n  },\n\n  moveLeft: (p: IPiece[]) => {\n    let changed = false\n    for (let y = 0; y < 4; y++) {\n      let min = 0\n      for (let x = 1; x < 4; x++) {\n        let curr = -1\n        const isOccupied = p.some((i, index) => {\n          const occupied = i.x === (x - 1) && i.y === y\n          if (i.x === x && i.y === y) { curr = index }\n          if (occupied) { min++ }\n          return occupied\n        })\n        if (!isOccupied && curr >= 0) {\n          p[curr].x = min\n          changed = true\n          min++\n        }\n      }\n      for (let x = 1; x < 4; x++) {\n        const { v: currV, index: currIndex } = getValue(x, y, p)\n        const { v: nextV, index: nextIndex } = getValue(x - 1, y, p)\n        if (currV && nextV && currV === nextV) {\n          p[currIndex].x = x - 1\n          p[currIndex].merged = true\n          p[nextIndex].merged = true\n          for (let v = x; v <= 3; v++) {\n            const { index: i } = getValue(v, y, p)\n            if (i >= 0) { p[i].x = p[i].x > 0 ? p[i].x - 1 : p[i].x }\n          }\n          p.push({ x: x - 1, y, v: currV * 2, id: Math.random() })\n          changed = true\n        }\n      }\n    }\n    return { p, changed }\n  },\n\n  moveDown: (p: IPiece[]) => {\n    let changed = false\n    for (let x = 0; x < 4; x++) {\n      let max = 3\n      for (let y = 2; y >= 0; y--) {\n        let curr = -1\n        const isOccupied = p.some((i, index) => {\n          const occupied = i.x === x && i.y === (y + 1)\n          if (i.x === x && i.y === y) { curr = index }\n          if (occupied) { max-- }\n          return occupied\n        })\n        if (!isOccupied && curr >= 0) {\n          p[curr].y = max\n          changed = true\n          max--\n        }\n      }\n      for (let y = 2; y >= 0; y--) {\n        const { v: currV, index: currIndex } = getValue(x, y, p)\n        const { v: nextV, index: nextIndex } = getValue(x, y + 1, p)\n        if (currV && nextV && currV === nextV) {\n          p[currIndex].y = y + 1\n          p[currIndex].merged = true\n          p[nextIndex].merged = true\n          for (let v = y - 1; v >= 0; v--) {\n            const { index: i } = getValue(x, v, p)\n            if (i >= 0) { p[i].y = p[i].y < 3 ? p[i].y + 1 : p[i].y }\n          }\n          p.push({ x, y: y + 1, v: currV * 2, id: Math.random() })\n          changed = true\n        }\n      }\n    }\n    return { p, changed }\n  },\n\n  moveUp: (p: IPiece[]) => {\n    let changed = false\n    for (let x = 0; x < 4; x++) {\n      let min = 0\n      for (let y = 1; y < 4; y++) {\n        let curr = -1\n        const isOccupied = p.some((i, index) => {\n          const occupied = i.x === x && i.y === (y - 1)\n          if (i.x === x && i.y === y) { curr = index }\n          if (occupied) { min++ }\n          return occupied\n        })\n        if (!isOccupied && curr >= 0) {\n          p[curr].y = min\n          changed = true\n          min++\n        }\n      }\n      for (let y = 1; y < 4; y++) {\n        const { v: currV, index: currIndex } = getValue(x, y, p)\n        const { v: nextV, index: nextIndex } = getValue(x, y - 1, p)\n        if (currV && nextV && currV === nextV) {\n          p[currIndex].y = y - 1\n          p[currIndex].merged = true\n          p[nextIndex].merged = true\n          for (let v = y; v <= 3; v++) {\n            const { index: i } = getValue(x, v, p)\n            if (i >= 0) { p[i].y = p[i].y > 0 ? p[i].y - 1 : p[i].y }\n          }\n          p.push({ x, y: y - 1, v: currV * 2, id: Math.random() })\n          changed = true\n        }\n      }\n    }\n    return { p, changed }\n  }\n}\n","'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar START_EVENT_NAME_MAP = {\n  transitionstart: {\n    transition: 'transitionstart',\n    WebkitTransition: 'webkitTransitionStart',\n    MozTransition: 'mozTransitionStart',\n    OTransition: 'oTransitionStart',\n    msTransition: 'MSTransitionStart'\n  },\n\n  animationstart: {\n    animation: 'animationstart',\n    WebkitAnimation: 'webkitAnimationStart',\n    MozAnimation: 'mozAnimationStart',\n    OAnimation: 'oAnimationStart',\n    msAnimation: 'MSAnimationStart'\n  }\n};\n\nvar END_EVENT_NAME_MAP = {\n  transitionend: {\n    transition: 'transitionend',\n    WebkitTransition: 'webkitTransitionEnd',\n    MozTransition: 'mozTransitionEnd',\n    OTransition: 'oTransitionEnd',\n    msTransition: 'MSTransitionEnd'\n  },\n\n  animationend: {\n    animation: 'animationend',\n    WebkitAnimation: 'webkitAnimationEnd',\n    MozAnimation: 'mozAnimationEnd',\n    OAnimation: 'oAnimationEnd',\n    msAnimation: 'MSAnimationEnd'\n  }\n};\n\nvar startEvents = [];\nvar endEvents = [];\n\nfunction detectEvents() {\n  var testEl = document.createElement('div');\n  var style = testEl.style;\n\n  if (!('AnimationEvent' in window)) {\n    delete START_EVENT_NAME_MAP.animationstart.animation;\n    delete END_EVENT_NAME_MAP.animationend.animation;\n  }\n\n  if (!('TransitionEvent' in window)) {\n    delete START_EVENT_NAME_MAP.transitionstart.transition;\n    delete END_EVENT_NAME_MAP.transitionend.transition;\n  }\n\n  function process(EVENT_NAME_MAP, events) {\n    for (var baseEventName in EVENT_NAME_MAP) {\n      if (EVENT_NAME_MAP.hasOwnProperty(baseEventName)) {\n        var baseEvents = EVENT_NAME_MAP[baseEventName];\n        for (var styleName in baseEvents) {\n          if (styleName in style) {\n            events.push(baseEvents[styleName]);\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  process(START_EVENT_NAME_MAP, startEvents);\n  process(END_EVENT_NAME_MAP, endEvents);\n}\n\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n  detectEvents();\n}\n\nfunction addEventListener(node, eventName, eventListener) {\n  node.addEventListener(eventName, eventListener, false);\n}\n\nfunction removeEventListener(node, eventName, eventListener) {\n  node.removeEventListener(eventName, eventListener, false);\n}\n\nvar TransitionEvents = {\n  // Start events\n  startEvents: startEvents,\n\n  addStartEventListener: function addStartEventListener(node, eventListener) {\n    if (startEvents.length === 0) {\n      window.setTimeout(eventListener, 0);\n      return;\n    }\n    startEvents.forEach(function (startEvent) {\n      addEventListener(node, startEvent, eventListener);\n    });\n  },\n  removeStartEventListener: function removeStartEventListener(node, eventListener) {\n    if (startEvents.length === 0) {\n      return;\n    }\n    startEvents.forEach(function (startEvent) {\n      removeEventListener(node, startEvent, eventListener);\n    });\n  },\n\n\n  // End events\n  endEvents: endEvents,\n\n  addEndEventListener: function addEndEventListener(node, eventListener) {\n    if (endEvents.length === 0) {\n      window.setTimeout(eventListener, 0);\n      return;\n    }\n    endEvents.forEach(function (endEvent) {\n      addEventListener(node, endEvent, eventListener);\n    });\n  },\n  removeEndEventListener: function removeEndEventListener(node, eventListener) {\n    if (endEvents.length === 0) {\n      return;\n    }\n    endEvents.forEach(function (endEvent) {\n      removeEventListener(node, endEvent, eventListener);\n    });\n  }\n};\n\nexports['default'] = TransitionEvents;\nmodule.exports = exports['default'];","export default {\n  keyCode: {\n    left: 37,\n    up: 38,\n    right: 39,\n    down: 40\n  }\n}\n","import Utils from '@utils'\nimport { Button, Icon, Popconfirm } from 'antd'\nimport React from 'react'\nimport './index.less'\nimport Tools from './tools'\nimport common from '@constant/common'\nconst storage = new Utils.Storage('2048')\nconst { keyCode } = common\n\ninterface IPiece {\n  x: number,\n  y: number,\n  v: number,\n  id: number,\n  merged?: boolean\n}\n\ninterface IState {\n  size: number,\n  pieces: IPiece[],\n  cached: {\n    x: number,\n    y: number\n  }\n}\n\ninterface IProp {\n  isMobile: boolean\n}\n\nclass Page2048 extends React.Component<IProp, IState> {\n\n  constructor (props) {\n    super(props)\n    this.reset(storage.get('pieces'), true)\n    document.addEventListener('keydown', this.keydown)\n  }\n\n  reset = (pieces, isInited) => {\n    if (!Utils.isArray(pieces)) {\n      pieces = []\n      this.addRandom(pieces, true)\n      this.addRandom(pieces, true)\n      storage.set('pieces', null)\n    }\n\n    const state = {\n      size: 4,\n      pieces,\n      cached: { x: 0, y: 0 }\n    }\n\n    if (isInited) {\n      this.state = { ...state }\n    } else {\n      this.setState(state)\n    }\n  }\n\n  componentDidMount () {\n    document.addEventListener('touchstart', this.touchstart)\n    document.addEventListener('touchmove', this.touchmove)\n    document.addEventListener('touchend', this.touchend)\n  }\n\n  componentWillUnmount () {\n    document.removeEventListener('keydown', this.keydown)\n    document.removeEventListener('touchstart', this.touchstart)\n    document.removeEventListener('touchmove', this.touchmove)\n    document.removeEventListener('touchend', this.touchend)\n  }\n\n  removeMerged = f => {\n    const { pieces: p } = this.state\n    const pieces = p.filter(i => !i.merged)\n    this.setState({ pieces }, f)\n  }\n\n  touchstart = e => {\n    const { pageX, pageY } = e.changedTouches[0]\n    this.setState({ cached: { x: pageX, y: pageY } })\n  }\n\n  touchmove = e => e.preventDefault()\n\n  touchend = e => {\n    const { x: sx, y: sy } = this.state.cached\n    const { pageX : ex, pageY: ey } = e.changedTouches[0]\n    let code = 0\n    if (Math.abs(sx - ex) > Math.abs(sy - ey) && Math.abs(sx - ex) > 20) {\n      code = sx - ex > 0 ? keyCode.left : keyCode.right\n    } else if (Math.abs(sx - ex) < Math.abs(sy - ey) && Math.abs(sy - ey) > 20) {\n      code = sy - ey > 0 ? keyCode.up : keyCode.down\n    } else {\n      return\n    }\n    this.doMove(code)\n  }\n\n  keydown = e => this.doMove(e.keyCode)\n\n  doMove = code => {\n    this.removeMerged(() => {\n      const { pieces } = this.state\n      let p: IPiece[] = pieces\n      switch (code) {\n        case keyCode.up:\n          const { p: up, changed: uc } = Tools.moveUp(pieces)\n          if (uc) { p = this.addRandom(up) }\n          break\n        case keyCode.down:\n          const { p: dp, changed: dc } = Tools.moveDown(pieces)\n          if (dc) { p = this.addRandom(dp) }\n          break\n        case keyCode.left:\n          const { p: lp, changed: lc } = Tools.moveLeft(pieces)\n          if (lc) { p = this.addRandom(lp) }\n          break\n        case keyCode.right:\n          const { p: rp, changed: rc } = Tools.moveRight(pieces)\n          if (rc) { p = this.addRandom(rp) }\n          break\n      }\n      this.setState({ pieces: p })\n    })\n  }\n\n  addRandom = (p, isReset?) => {\n    if (!isReset) { setTimeout(() => this.setStorage(p), 0) }\n    const i = this.doAddRandom(p)\n    if (i) { p.push(i) }\n    return p\n  }\n\n  setStorage = p => {\n    storage.set('pieces', Utils.clone(p).filter((item, i) => {\n      item.id = i\n      return !item.merged\n    }))\n  }\n\n  doAddRandom = p => {\n    if (p.length === 16) { return null }\n    const x = Utils.random(0, 4)\n    const y = Utils.random(0, 4)\n    return p.some(i => i.x === x && i.y === y)\n      ? this.doAddRandom(p)\n      : { x, y, v: this.get4or2(), id: Math.random() }\n  }\n\n  get4or2 = () => Math.random() > .9 ? 4 : 2\n\n  renderGrid = () => new Array(this.state.size).fill(null).map((v1, x) => (\n    <div className='row' key={x}>\n      {\n        new Array(this.state.size).fill(null).map((v2, y) => (\n          <div className='item' key={y}/>\n        ))\n      }\n    </div>\n  ))\n\n  isGameOver = pieces => {\n    const { size } = this.state\n    if (pieces.filter(p => !p.merged).length !== size * size) {\n      return false\n    }\n\n    const list: number[][] = [\n      [0, 0, 0, 0],\n      [0, 0, 0, 0],\n      [0, 0, 0, 0],\n      [0, 0, 0, 0]\n    ]\n\n    pieces.forEach(({ x, y, v }) => list[x][y] = v)\n\n    return this.canMove(list)\n  }\n\n  canMove = data => {\n    for (let r = 0; r < data.length; r++) {\n      for (let c = 0; c < data[r].length; c++) {\n        if (data[r][c] === 0) {\n          return false\n        } else if (c < data[r].length - 1\n          && data[r][c] === data[r][c + 1]) {\n          return false\n        } else if (r < data.length - 1\n          && data[r][c] === data[r + 1][c]) {\n          return false\n        }\n      }\n    }\n    return true\n  }\n\n  render () {\n    const { pieces } = this.state\n    return (\n      <div className='game2048-wrapper'>\n        <div className='game2048-container' >\n          <div className='grid'>\n            { this.renderGrid() }\n          </div>\n          <div className='piece-contanier'>\n            {\n              (pieces || []).map(item => (\n                <div className={`piece piece-${item.v} piece-position-${item.x}-${item.y} ${item.merged ? 'merged' : ''}`} key={item.id} >\n                  <div className='item'>\n                    {\n                      item.v === 2048\n                        ? <Icon type='ts-app icon-batman' />\n                        : item.v\n                    }\n                  </div>\n                </div>\n              ))\n            }\n          </div>\n          <div className={this.isGameOver(pieces) ? 'mask' : 'mask hidden'}>\n            Game Over\n          </div>\n        </div>\n        <div className='btn-container'>\n          <Popconfirm title='Sure about that?' onConfirm={Utils.handle(this.reset)} okText='Yes' cancelText='No'>\n            <Button type='primary' className='reset-btn'>\n              Reset\n            </Button>\n          </Popconfirm>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default Page2048\n"],"sourceRoot":""}